/*

# Fitur : Kalender Maker
# Type : Plugins ESM
# Created by : https://whatsapp.com/channel/0029VbAXI4B1iUxRoQ1aQF24
# Api : Lokal (Canvas)

   ⚠️ _Note_ ⚠️
jangan hapus wm ini banggg

*/

import { createCanvas } from 'canvas'

let handler = async (m, { conn }) => {
  try {
    let now = new Date()
    let tahun = now.getFullYear()
    let bulan = now.getMonth()
    let hariIni = now.getDate()

    let namaBulan = [
      'Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
      'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'
    ]
    let namaHari = ['Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab', 'Min']

    let hariDalamBulan = new Date(tahun, bulan + 1, 0).getDate()
    let startDay = new Date(tahun, bulan, 1).getDay()
    if (startDay === 0) startDay = 7

    let width = 800
    let height = 600
    let canvas = createCanvas(width, height)
    let ctx = canvas.getContext('2d')

    ctx.fillStyle = '#f5f5f5'
    ctx.fillRect(0, 0, width, height)

    ctx.fillStyle = '#3498db'
    ctx.fillRect(0, 0, width, 90)

    ctx.fillStyle = 'white'
    ctx.font = 'bold 40px Sans'
    ctx.textAlign = 'center'
    ctx.shadowColor = 'rgba(0,0,0,0.3)'
    ctx.shadowBlur = 4
    ctx.fillText(`${namaBulan[bulan]} ${tahun}`, width / 2, 55)
    ctx.shadowBlur = 0

    let cellWidth = width / 7
    let cellHeight = 60
    ctx.font = 'bold 22px Sans'
    namaHari.forEach((hari, i) => {
      ctx.fillStyle = (hari === 'Sab' || hari === 'Min') ? '#e74c3c' : '#2c3e50'
      ctx.fillText(hari, cellWidth * i + cellWidth / 2, 120)
    })

    ctx.font = '20px Sans'
    let col = startDay - 1
    let row = 0
    let startY = 140

    for (let tgl = 1; tgl <= hariDalamBulan; tgl++) {
      let x = col * cellWidth
      let y = startY + row * cellHeight
      let dayOfWeek = new Date(tahun, bulan, tgl).getDay()
      if (dayOfWeek === 0) dayOfWeek = 7

      ctx.fillStyle = (dayOfWeek === 6 || dayOfWeek === 7) ? '#fdecea' : '#ffffff'
      ctx.fillRect(x, y, cellWidth, cellHeight)

      ctx.strokeStyle = '#ccc'
      ctx.strokeRect(x, y, cellWidth, cellHeight)

      if (tgl === hariIni) {
        ctx.beginPath()
        ctx.arc(x + cellWidth / 2, y + cellHeight / 2, 20, 0, Math.PI * 2)
        ctx.fillStyle = '#e74c3c'
        ctx.fill()
        ctx.closePath()
        ctx.fillStyle = 'white'
        ctx.font = 'bold 20px Sans'
      } else {
        ctx.fillStyle = '#2c3e50'
        ctx.font = '20px Sans'
      }

      ctx.textAlign = 'center'
      ctx.textBaseline = 'middle'
      ctx.fillText(tgl.toString(), x + cellWidth / 2, y + cellHeight / 2)

      col++
      if (col > 6) {
        col = 0
        row++
      }
    }

    ctx.fillStyle = '#999'
    ctx.font = 'italic 14px Sans'
    ctx.textAlign = 'right'
    ctx.textBaseline = 'alphabetic'
    ctx.fillText('Generated by Cuki Digital', width - 10, height - 10)

    let buffer = canvas.toBuffer()
    await conn.sendFile(m.chat, buffer, 'kalender.png', '', m)
  } catch (err) {
    m.reply(`❌ Error\nLogs error : ${err}`)
  }
}

handler.help = ['kalender']
handler.tags = ['tools']
handler.command = /^kalender$/i

export default handler